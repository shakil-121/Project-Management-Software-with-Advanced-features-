@model FastPMS.Models.Domain.Users
@{
    ViewData["Title"] = "My Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <!-- Breadcrumb -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("MyProjectStatus", "Project")">My Projects</a></li>
                    <li class="breadcrumb-item active">My Profile</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">My Profile</h2>
                    <p class="text-muted mb-0">Manage your account information and preferences</p>
                </div>
                <div>
                    <span class="badge bg-success fs-6">
                        <i class='bx bx-user-check me-1'></i> @Model.Role
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class='bx bx-check-circle me-2'></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class='bx bx-error-circle me-2'></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row">
        <!-- Left Column - Profile Information -->
        <div class="col-lg-8">
            <!-- Personal Information Card -->
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class='bx bx-user me-2'></i> Personal Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%" class="text-muted">Full Name:</th>
                                    <td>
                                        <strong>@Model.FullName</strong>
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="editField('name')">
                                            <i class='bx bx-edit'></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="text-muted">Email Address:</th>
                                    <td>
                                        <i class='bx bx-envelope me-1 text-primary'></i>
                                        @Model.Email
                                        <span class="badge bg-success ms-2">Verified</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="text-muted">Phone Number:</th>
                                    <td>
                                        <i class='bx bx-phone me-1 text-primary'></i>
                                        @(string.IsNullOrEmpty(Model.PhoneNumber) ? "Not provided" : Model.PhoneNumber)
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="editField('phone')">
                                            <i class='bx bx-edit'></i>
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%" class="text-muted">User Role:</th>
                                    <td>
                                        <span class="badge bg-success">@Model.Role</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="text-muted">Department:</th>
                                    <td>
                                        @(string.IsNullOrEmpty(Model.Department) ? "Not assigned" : Model.Department)
                                    </td>
                                </tr>
                                <tr>
                                    <th class="text-muted">Member Since:</th>
                                    <td>
                                        <i class='bx bx-calendar me-1 text-primary'></i>
                                        @DateTime.Now.ToString("MMM dd, yyyy")
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- Account Statistics -->
                    <div class="mt-4">
                        <h6 class="text-muted mb-3"><i class='bx bx-stats me-2'></i> Account Statistics</h6>
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="card border-primary">
                                    <div class="card-body py-3">
                                        <h4 class="text-primary mb-1" id="totalProjects">0</h4>
                                        <small class="text-muted">Total Projects</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-success">
                                    <div class="card-body py-3">
                                        <h4 class="text-success mb-1" id="completedProjects">0</h4>
                                        <small class="text-muted">Completed</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-warning">
                                    <div class="card-body py-3">
                                        <h4 class="text-warning mb-1" id="activeProjects">0</h4>
                                        <small class="text-muted">Active</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-info">
                                    <div class="card-body py-3">
                                        <h4 class="text-info mb-1" id="overdueProjects">0</h4>
                                        <small class="text-muted">Overdue</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Settings Card -->
            <div class="card shadow mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class='bx bx-shield-alt me-2'></i> Security Settings</h5>
                </div>
                <div class="card-body">
                    <div class="security-settings">
                        <div class="security-item">
                            <div class="security-icon">
                                <i class='bx bx-lock-alt text-success'></i>
                            </div>
                            <div class="security-content">
                                <h6>Password</h6>
                                <p class="text-muted mb-2">Last changed: Recently</p>
                                <button class="btn btn-outline-primary btn-sm" onclick="changePassword()">
                                    <i class='bx bx-edit me-1'></i> Change Password
                                </button>
                            </div>
                        </div>

                        <div class="security-item">
                            <div class="security-icon">
                                <i class='bx bx-devices text-info'></i>
                            </div>
                            <div class="security-content">
                                <h6>Active Sessions</h6>
                                <p class="text-muted mb-2">Current device: Web Browser</p>
                                <button class="btn btn-outline-secondary btn-sm" onclick="viewSessions()">
                                    <i class='bx bx-list-ul me-1'></i> View All Sessions
                                </button>
                            </div>
                        </div>

                        <div class="security-item">
                            <div class="security-icon">
                                <i class='bx bx-bell text-primary'></i>
                            </div>
                            <div class="security-content">
                                <h6>Notifications</h6>
                                <p class="text-muted mb-2">Email notifications are enabled</p>
                                <button class="btn btn-outline-info btn-sm" onclick="manageNotifications()">
                                    <i class='bx bx-cog me-1'></i> Manage Notifications
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Quick Actions & Profile Summary -->
        <div class="col-lg-4">
            <!-- Profile Summary Card -->
            <div class="card shadow mb-4">
                <div class="card-header bg-success text-white text-center">
                    <div class="avatar-section">
                        <div class="avatar-placeholder">
                            <i class='bx bx-user'></i>
                        </div>
                        <h5 class="mt-3 mb-0">@Model.FullName</h5>
                        <p class="mb-0 opacity-75">@Model.Role</p>
                    </div>
                </div>
                <div class="card-body text-center">
                    <div class="profile-stats">
                        <div class="stat-item">
                            <i class='bx bx-folder text-primary'></i>
                            <div>
                                <h5 class="mb-0" id="profileTotalProjects">0</h5>
                                <small class="text-muted">Projects</small>
                            </div>
                        </div>
                        <div class="stat-item">
                            <i class='bx bx-check-circle text-success'></i>
                            <div>
                                <h5 class="mb-0" id="profileCompleted">0</h5>
                                <small class="text-muted">Completed</small>
                            </div>
                        </div>
                    </div>

                    <div class="progress mt-3 mb-3" style="height: 8px;">
                        <div class="progress-bar bg-success" id="completionProgress"
                             role="progressbar" style="width: 0%"
                             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <small class="text-muted" id="completionText">Project Completion: 0%</small>
                </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class='bx bx-rocket me-2'></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Url.Action("MyProjectStatus", "Project")" class="btn btn-outline-primary">
                            <i class='bx bx-folder me-2'></i> My Projects
                        </a>
                        <button class="btn btn-outline-success" onclick="editProfile()">
                            <i class='bx bx-edit me-2'></i> Edit Profile
                        </button>
                        <button class="btn btn-outline-warning" onclick="contactSupport()">
                            <i class='bx bx-support me-2'></i> Contact Support
                        </button>
                        <button class="btn btn-outline-info" onclick="downloadProfileData()">
                            <i class='bx bx-download me-2'></i> Export Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- System Information Card -->
            <div class="card shadow">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class='bx bx-info-circle me-2'></i> System Information</h5>
                </div>
                <div class="card-body">
                    <div class="system-info">
                        <div class="info-item">
                            <i class='bx bx-calendar text-primary'></i>
                            <div>
                                <small class="text-muted">Last Login</small>
                                <div><strong>@DateTime.Now.ToString("MMM dd, yyyy 'at' hh:mm tt")</strong></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class='bx bx-time text-success'></i>
                            <div>
                                <small class="text-muted">Account Created</small>
                                <div><strong>@DateTime.Now.AddMonths(-1).ToString("MMM dd, yyyy")</strong></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class='bx bx-shield text-warning'></i>
                            <div>
                                <small class="text-muted">Account Status</small>
                                <div><strong class="text-success">Active</strong></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class='bx bx-globe text-info'></i>
                            <div>
                                <small class="text-muted">Timezone</small>
                                <div><strong>UTC+6 (Bangladesh)</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Profile Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="profileForm">
                    <div class="mb-3">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="fullName" value="@Model.FullName">
                    </div>
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phoneNumber" value="@Model.PhoneNumber">
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" value="@Model.Email" readonly>
                        <div class="form-text">Email cannot be changed. Contact support for email changes.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .card {
            border: 1px solid #e3e6f0;
            border-radius: 0.5rem;
        }

        .table-borderless td, .table-borderless th {
            border: none;
            padding: 12px 0;
        }

        /* Avatar Styles */
        .avatar-placeholder {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 2rem;
        }

        /* Security Settings */
        .security-settings .security-item {
            display: flex;
            align-items: flex-start;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

            .security-settings .security-item:last-child {
                border-bottom: none;
            }

        .security-settings .security-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .security-settings .security-content {
            flex: 1;
        }

        /* Profile Stats */
        .profile-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

            .profile-stats .stat-item {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

                .profile-stats .stat-item i {
                    font-size: 1.5rem;
                    margin-bottom: 5px;
                }

        /* System Information */
        .system-info .info-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

            .system-info .info-item:last-child {
                border-bottom: none;
            }

            .system-info .info-item i {
                font-size: 1.2rem;
                margin-right: 15px;
                width: 20px;
                text-align: center;
            }

        .breadcrumb {
            background: transparent;
            padding: 0;
        }

        .progress {
            border-radius: 0.25rem;
        }
    </style>
}

@section Scripts {
    <script>
                // Load profile statistics
                document.addEventListener('DOMContentLoaded', function() {
                    loadProfileStatistics();
                });

                function loadProfileStatistics() {
                    // Simulate API call to get project statistics
                    setTimeout(() => {
                        // Mock data - in real app, fetch from API
                        const totalProjects = 8;
                        const completedProjects = 3;
                        const activeProjects = 4;
                        const overdueProjects = 1;
                        const completionRate = Math.round((completedProjects / totalProjects) * 100);

                        // Update statistics
                        document.getElementById('totalProjects').textContent = totalProjects;
                        document.getElementById('completedProjects').textContent = completedProjects;
                        document.getElementById('activeProjects').textContent = activeProjects;
                        document.getElementById('overdueProjects').textContent = overdueProjects;

                        // Update profile stats
                        document.getElementById('profileTotalProjects').textContent = totalProjects;
                        document.getElementById('profileCompleted').textContent = completedProjects;

                        // Update progress bar
                        const progressBar = document.getElementById('completionProgress');
                        progressBar.style.width = completionRate + '%';
                        progressBar.setAttribute('aria-valuenow', completionRate);
                        document.getElementById('completionText').textContent = 'Project Completion: ' + completionRate + '%';
                    }, 1000);
                }

                function editField(field) {
                    alert('Edit ' + field + ' functionality will be implemented soon.');
                }

                function editProfile() {
                    const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
                    modal.show();
                }

                function saveProfile() {
                    const fullName = document.getElementById('fullName').value;
                    const phoneNumber = document.getElementById('phoneNumber').value;

                    // Simulate API call
                    setTimeout(() => {
                        alert('Profile updated successfully!');
                        const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
                        modal.hide();

                        // Show success message
                        showAlert('Profile information updated successfully!', 'success');
                    }, 1000);
                }

                function changePassword() {
                    // Redirect to change password page or show modal
                    window.location.href = '@Url.Action("ChangePassword", "Account")';
                }

                function viewSessions() {
                    alert('Active sessions management will be available in the next update.');
                }

                function manageNotifications() {
                    alert('Notification settings will be available in the next update.');
                }

                function contactSupport() {
                    const chatUrl = '@Url.Action("Index", "Chat")';
                    if (chatUrl && chatUrl !== '@Url.Action("Index", "Chat")') {
                        window.location.href = chatUrl;
                    } else {
                        alert('Please use the Live Chat feature to contact support.');
                    }
                }

                function downloadProfileData() {
                    const profileData = `
        PROFILE INFORMATION
        ===================

        Personal Details:
        -----------------
        Full Name: @Model.FullName
        Email: @Model.Email
        Phone: @(string.IsNullOrEmpty(Model.PhoneNumber) ? "Not provided" : Model.PhoneNumber)
        Role: @Model.Role
        Department: @(string.IsNullOrEmpty(Model.Department) ? "Not assigned" : Model.Department)

        Account Information:
        -------------------
        Member Since: @DateTime.Now.AddMonths(-1).ToString("MMMM dd, yyyy")
        Last Login: @DateTime.Now.ToString("MMMM dd, yyyy 'at' hh:mm tt")
        Status: Active

        Project Statistics:
        ------------------
        Total Projects: 8
        Completed Projects: 3
        Active Projects: 4
        Overdue Projects: 1
        Completion Rate: 37.5%

        Generated on: @DateTime.Now.ToString("MMMM dd, yyyy 'at' hh:mm tt")
                    `.trim();

                    const blob = new Blob([profileData], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Profile_@(Model.FullName.Replace(" ", "_"))_Data.txt';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }

                function showAlert(message, type) {
                    // Create and show alert (you can enhance this with toast notifications)
                    alert(message);
                }

                // Auto-hide alerts after 5 seconds
                document.addEventListener('DOMContentLoaded', function() {
                    const alerts = document.querySelectorAll('.alert');
                    alerts.forEach(alert => {
                        setTimeout(() => {
                            const bsAlert = new bootstrap.Alert(alert);
                            bsAlert.close();
                        }, 5000);
                    });
                });
    </script>
}